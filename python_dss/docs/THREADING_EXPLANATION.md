# –ú–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å –≤ DynStabSpace

## üìä –ö–∞–∫ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. –î–≤–∞ —É—Ä–æ–≤–Ω—è –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç–∏

#### –£—Ä–æ–≤–µ–Ω—å 1: UI (–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å)
**–ì–¥–µ:** `ui/modern_main_window.py`, `ui/main_window.py`

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –ó–∞–ø—É—Å–∫–∞–µ—Ç —Ä–∞—Å—á–µ—Ç—ã –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ, —á—Ç–æ–±—ã UI –Ω–µ –∑–∞–≤–∏—Å–∞–ª
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–æ—Å—Ç–æ–π `threading.Thread`

**–ü—Ä–∏–º–µ—Ä:**
```python
def _calc_shunt_kz(self):
    def run_calc():
        # –†–∞—Å—á–µ—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ —Ñ–æ–Ω–µ
        result = self.data_info.calc_shunt_kz(...)
    
    thread = threading.Thread(target=run_calc, daemon=True)
    thread.start()  # –ó–∞–ø—É—Å–∫ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ
```

**–°–∫–æ–ª—å–∫–æ –ø–æ—Ç–æ–∫–æ–≤:** 1 –ø–æ—Ç–æ–∫ –Ω–∞ –∫–∞–∂–¥—ã–π —Ä–∞—Å—á–µ—Ç (–º–∞–∫—Å–∏–º—É–º 1 –∞–∫—Ç–∏–≤–Ω—ã–π —Ä–∞—Å—á–µ—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ)

---

#### –£—Ä–æ–≤–µ–Ω—å 2: –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ —Ä–∞—Å—á–µ—Ç—ã (PerformanceOptimizer)
**–ì–¥–µ:** `utils/performance.py`

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞—Å—á–µ—Ç–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `ThreadPoolExecutor` –∏–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏

**–ü—Ä–∏–º–µ—Ä:**
```python
from utils.performance import performance_optimizer

# –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–ª—è —Å–ø–∏—Å–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
results = performance_optimizer.parallel_map(
    func=my_calculation_function,
    items=[item1, item2, item3, item4]
)
# –í—Å–µ 4 —ç–ª–µ–º–µ–Ω—Ç–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ!
```

---

## üî¢ –°–∫–æ–ª—å–∫–æ –ø–æ—Ç–æ–∫–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è?

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ

**–§–æ—Ä–º—É–ª–∞:**
```python
max_workers = min(4, (threading.active_count() or 1) + 4)
```

**–ß—Ç–æ —ç—Ç–æ –∑–Ω–∞—á–∏—Ç:**
- **–ú–∏–Ω–∏–º—É–º:** 4 –ø–æ—Ç–æ–∫–∞
- **–ú–∞–∫—Å–∏–º—É–º:** –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —É–∂–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤
- **–ü—Ä–∏–º–µ—Ä—ã:**
  - –ï—Å–ª–∏ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤ 1 ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è 4 –ø–æ—Ç–æ–∫–∞
  - –ï—Å–ª–∏ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤ 2 ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è 4 –ø–æ—Ç–æ–∫–∞ (–º–∏–Ω–∏–º—É–º)
  - –ï—Å–ª–∏ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤ 5 ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è 5 –ø–æ—Ç–æ–∫–æ–≤
  - –ï—Å–ª–∏ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤ 10 ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è 4 –ø–æ—Ç–æ–∫–∞ (–º–∏–Ω–∏–º—É–º)

**–ü–æ—á–µ–º—É —Ç–∞–∫:**
- 4 –ø–æ—Ç–æ–∫–∞ - –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –∑–∞–¥–∞—á
- –ù–µ –ø–µ—Ä–µ–≥—Ä—É–∂–∞–µ—Ç —Å–∏—Å—Ç–µ–º—É
- –£—á–∏—Ç—ã–≤–∞–µ—Ç —É–∂–µ –∑–∞–ø—É—â–µ–Ω–Ω—ã–µ –ø–æ—Ç–æ–∫–∏

### –ú–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –≤—Ä—É—á–Ω—É—é

```python
from utils.performance import PerformanceOptimizer

# –°–æ–∑–¥–∞—Ç—å —Å 8 –ø–æ—Ç–æ–∫–∞–º–∏
optimizer = PerformanceOptimizer(max_workers=8)

# –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä
performance_optimizer.max_workers = 8
```

---

## üéØ –ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–µ–π—á–∞—Å

### ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:

1. **UI –ø–æ—Ç–æ–∫–∏** (–≤—Å–µ–≥–¥–∞):
   - –ö–∞–∂–¥—ã–π —Ä–∞—Å—á–µ—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ
   - UI –æ—Å—Ç–∞–µ—Ç—Å—è –æ—Ç–∑—ã–≤—á–∏–≤—ã–º –≤–æ –≤—Ä–µ–º—è —Ä–∞—Å—á–µ—Ç–æ–≤

2. **PerformanceOptimizer** (–≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é):
   - –ú–µ—Ç–æ–¥—ã `parallel_map()` –∏ `parallel_calc()` –≥–æ—Ç–æ–≤—ã
   - –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö —Ä–∞—Å—á–µ—Ç–æ–≤

### ‚ö†Ô∏è –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è:

**–°–µ–π—á–∞—Å —Ä–∞—Å—á–µ—Ç—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ:**
```python
# –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è (–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ)
for rgm in rgms:
    for vrn in vrns:
        for scn in scns:
            # –†–∞—Å—á–µ—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –æ–¥–∏–Ω –∑–∞ –¥—Ä—É–≥–∏–º
            result = calculate(rgm, vrn, scn)
```

**–ú–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ):**
```python
# –° –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç—å—é
from utils.performance import performance_optimizer

# –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–ª—è –≤—Å–µ—Ö —Ä–∞—Å—á–µ—Ç–æ–≤
calc_params = []
for rgm in rgms:
    for vrn in vrns:
        for scn in scns:
            calc_params.append({
                'rgm': rgm,
                'vrn': vrn,
                'scn': scn
            })

# –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö —Ä–∞—Å—á–µ—Ç–æ–≤
results = performance_optimizer.parallel_calc(
    calc_func=calculate,
    calc_params=calc_params,
    progress_callback=update_progress
)
```

**–£—Å–∫–æ—Ä–µ–Ω–∏–µ:** –í 2-4 —Ä–∞–∑–∞ (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —è–¥–µ—Ä CPU)

---

## üìà –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ø–∏—Å–∫–∞

```python
from utils.performance import performance_optimizer

def process_file(file_path):
    # –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
    return process(file_path)

files = ["file1.rg2", "file2.rg2", "file3.rg2", "file4.rg2"]

# –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ (–º–µ–¥–ª–µ–Ω–Ω–æ)
results = [process_file(f) for f in files]  # 4 —Å–µ–∫—É–Ω–¥—ã

# –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ (–±—ã—Å—Ç—Ä–æ)
results = performance_optimizer.parallel_map(process_file, files)  # 1 —Å–µ–∫—É–Ω–¥–∞
```

### –ü—Ä–∏–º–µ—Ä 2: –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ —Ä–∞—Å—á–µ—Ç—ã

```python
from utils.performance import performance_optimizer

def single_calculation(rgm, scn):
    # –û–¥–∏–Ω —Ä–∞—Å—á–µ—Ç
    return calculate(rgm, scn)

# –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
params = [
    {'rgm': rgm1, 'scn': scn1},
    {'rgm': rgm2, 'scn': scn2},
    {'rgm': rgm3, 'scn': scn3},
    {'rgm': rgm4, 'scn': scn4}
]

# –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
results = performance_optimizer.parallel_calc(
    calc_func=single_calculation,
    calc_params=params,
    progress_callback=lambda x: print(f"–í—ã–ø–æ–ª–Ω–µ–Ω–æ: {x}")
)
```

---

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –ò–∑–º–µ–Ω–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ç–æ–∫–æ–≤

**–ß–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
```bash
export DSS_MAX_WORKERS=8
python main.py
```

**–í –∫–æ–¥–µ:**
```python
from utils.performance import performance_optimizer
performance_optimizer.max_workers = 8
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å—ã –≤–º–µ—Å—Ç–æ –ø–æ—Ç–æ–∫–æ–≤

–î–ª—è CPU-–∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á (–µ—Å–ª–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è RASTR COM):
```python
results = performance_optimizer.parallel_map(
    func=calculation,
    items=items,
    use_processes=True  # –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å—ã –≤–º–µ—Å—Ç–æ –ø–æ—Ç–æ–∫–æ–≤
)
```

---

## üîç –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

### –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:
- ‚úÖ UI –Ω–µ –∑–∞–≤–∏—Å–∞–µ—Ç (—Ä–∞—Å—á–µ—Ç—ã –≤ —Ñ–æ–Ω–µ)
- ‚úÖ –ì–æ—Ç–æ–≤–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç–∏
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ—Ç–æ–∫–æ–≤

### –ß—Ç–æ –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å:
- ‚ö†Ô∏è –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç—å –≤ —Ä–∞—Å—á–µ—Ç—ã (—Å–µ–π—á–∞—Å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ)
- ‚ö†Ô∏è –î–æ–±–∞–≤–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ—Ç–æ–∫–æ–≤ –≤ UI
- ‚ö†Ô∏è –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–æ—Ç–æ–∫–æ–≤ –≤ —Å—Ç–∞—Ç—É—Å-–±–∞—Ä–µ

---

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

**–û–∂–∏–¥–∞–µ–º–æ–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ:**
- 2-4 –ø–æ—Ç–æ–∫–∞: —É—Å–∫–æ—Ä–µ–Ω–∏–µ –≤ 1.5-3 —Ä–∞–∑–∞
- 4-8 –ø–æ—Ç–æ–∫–æ–≤: —É—Å–∫–æ—Ä–µ–Ω–∏–µ –≤ 2-4 —Ä–∞–∑–∞
- –ó–∞–≤–∏—Å–∏—Ç –æ—Ç:
  - –ö–æ–ª–∏—á–µ—Å—Ç–≤–∞ —è–¥–µ—Ä CPU
  - –¢–∏–ø–∞ –∑–∞–¥–∞—á–∏ (I/O –∏–ª–∏ CPU)
  - –ù–∞–ª–∏—á–∏—è GIL (Global Interpreter Lock) –≤ Python

**–î–ª—è RASTR:**
- RASTR COM –º–æ–∂–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç—å
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: 2-4 –ø–æ—Ç–æ–∫–∞ –¥–ª—è RASTR –æ–ø–µ—Ä–∞—Ü–∏–π

