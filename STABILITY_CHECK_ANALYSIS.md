# Анализ проблемы с проверкой устойчивости

## Ситуация

Пользователь сообщает, что при проверке устойчивости в узле **40903102** с параметрами:
- `r = 2.013210 Ом`
- `x = 7.996910 Ом`

**устойчивость нарушается**.

## Анализ

**Из лога:**
- `node_kz = 40903102` (узел, где происходит КЗ)
- `ip = 40903102` (узел начала линии)
- `iq = 409090012` (узел конца линии)
- `distance = 14.84%` (расстояние от начала линии до точки КЗ)

**Параметры линии:**
- `begin_r = 2.013210 Ом, begin_x = 7.996910 Ом` (ветвь от ip к точке КЗ)
- `end_r = 11.556790 Ом, end_x = 45.906090 Ом` (ветвь от точки КЗ к iq)

## Важное наблюдение

**Если `node_kz == ip` (40903102), то:**
- КЗ должно происходить в узле начала линии
- `distance` должна быть близка к 0% (если КЗ в самом узле)
- `begin_r/begin_x` должны быть почти нулевыми (почти нет сопротивления до точки КЗ)

**Но в текущих результатах:**
- `distance = 14.84%` - это означает, что КЗ происходит **на линии** на расстоянии 14.84% от узла начала, а не в самом узле
- `begin_r = 2.013210 Ом` - это 14.84% от исходного сопротивления линии
- `begin_x = 7.996910 Ом` - это 14.84% от исходного реактивного сопротивления

## Возможные причины проблемы

### 1. Несоответствие между `node_kz` и фактическим местом КЗ

Если `node_kz == ip`, но `distance = 14.84%`, это означает:
- КЗ происходит не в узле `ip`, а на линии на расстоянии 14.84% от него
- Параметры `begin_r/begin_x` соответствуют части линии от узла `ip` до точки КЗ
- Для проверки устойчивости в узле `ip` нужно использовать параметры, которые учитывают, что КЗ происходит в самом узле, а не на расстоянии от него

### 2. Интерпретация параметров

**Параметры `begin_r/begin_x`** - это параметры ветви от узла `ip` до точки КЗ (нового узла, где происходит КЗ).

**Для проверки устойчивости в узле `ip`:**
- Если КЗ происходит в узле `ip` (distance ≈ 0), то параметры для узла `ip` должны быть почти нулевыми
- Если КЗ происходит на линии (distance > 0), то параметры `begin_r/begin_x` соответствуют части линии от узла `ip` до точки КЗ

### 3. Возможная ошибка в логике

Если пользователь проверяет устойчивость в узле 40903102 с параметрами `r=2.013210, x=7.996910`, и устойчивость нарушается, это может означать:
- Параметры `begin_r/begin_x` не соответствуют тому, что должно быть для узла начала
- Возможно, нужно использовать другие параметры (например, параметры всей линии или параметры после точки КЗ)

## Вопросы для уточнения

1. **Где именно происходит КЗ?**
   - В узле 40903102 (distance ≈ 0)?
   - На линии на расстоянии 14.84% от узла 40903102?

2. **Что означает "устойчивость нарушается"?**
   - Система становится неустойчивой при этих параметрах?
   - Это ожидаемое поведение или ошибка?

3. **Какие параметры нужно использовать для проверки?**
   - Параметры части линии от узла начала до точки КЗ (`begin_r/begin_x`)?
   - Параметры всей линии?
   - Другие параметры?

## Рекомендации

1. **Проверить логику определения `distance`:**
   - Если `node_kz == ip`, то `distance` должна быть близка к 0%
   - Если `distance = 14.84%`, то КЗ происходит на линии, а не в узле

2. **Проверить соответствие параметров:**
   - `begin_r + end_r = 13.57 Ом` ✓
   - `begin_x + end_x = 53.903 Ом` ✓
   - Это означает, что параметры распределены правильно

3. **Проверить логику бинарного поиска:**
   - Если `node_kz == ip` и `l_start = 0.1`, то бинарный поиск должен найти `distance` близкую к 0%
   - Но в текущих результатах `distance = 14.84%`, что может указывать на проблему в логике

