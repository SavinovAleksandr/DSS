# Анализ результатов расчета "Определение остаточного напряжения при КЗ"

## Дата анализа: 2025-12-26

## 1. Анализ лога `stablimit (4).log`

### 1.1. Последний успешный расчет (строки 515-709)

**Параметры линии:**
- `r=13.57 Ом`
- `x=53.903 Ом`
- `ip=40903102` (узел начала)
- `iq=409090012` (узел конца)
- `np=0`

**Параметры шунта КЗ:**
- `r_shunt=0.001000 Ом`
- `x_shunt=0.001000 Ом`
- `z_mod=0.001414 Ом` (модуль комплексного сопротивления)
- `z_angle=0.785398 рад (45.00°)`

**Результаты начальных расчетов:**
- Первый расчет (l_start=0.10): `успех=True, устойчивость=False` ✓
- Второй расчет (l_end=99.90): `успех=True, устойчивость=True` ✓

**Бинарный поиск границы устойчивости:**
- Начальные значения: `l_stable=99.90, l_unstable=0.10, l_current=49.90` ✓ (правильно!)
- Итерации:
  - Итерация 0: `l_current=49.90, устойчивость=True`
  - Итерация 1: `l_stable=49.90, l_unstable=0.10, l_current=25.00, устойчивость=True`
  - Итерация 2: `l_stable=25.00, l_unstable=0.10, l_current=12.55, устойчивость=False`
  - Итерация 3: `l_stable=25.00, l_unstable=12.55, l_current=18.78, устойчивость=True`
  - Итерация 4: `l_stable=18.78, l_unstable=12.55, l_current=15.66, устойчивость=True`
  - Итерация 5: `l_stable=15.66, l_unstable=12.55, l_current=14.11, устойчивость=False`
  - Итерация 6: `l_stable=15.66, l_unstable=14.11, l_current=14.88, устойчивость=True`
  - Итерация 7: `l_stable=14.88, l_unstable=14.11, l_current=14.50, устойчивость=False`
  - Итерация 8: `l_stable=14.88, l_unstable=14.50, l_current=14.69, устойчивость=False`
  - Итерация 9: `l_stable=14.88, l_unstable=14.69, l_current=14.79, устойчивость=False`
  - Итерация 10: `l_stable=14.88, l_unstable=14.79, l_current=14.84, устойчивость=True` ✓

**Финальные результаты:**
- `distance=14.84%` ✓ (корректно, в диапазоне 0-100)
- `l_stable=14.84, l_unstable=14.79` ✓ (корректно обновлены после последней итерации)
- `begin_uost=60.25 кВ` ✓
- `end_uost=63.67 кВ` ✓
- `begin_r=2.013210 Ом, begin_x=7.996910 Ом` ✓
- `end_r=11.556790 Ом, end_x=45.906090 Ом` ✓

**Проверка корректности параметров линии:**
- `begin_r + end_r = 2.013210 + 11.556790 = 13.57 Ом` ✓ (совпадает с исходным `r=13.57`)
- `begin_x + end_x = 7.996910 + 45.906090 = 53.903 Ом` ✓ (совпадает с исходным `x=53.903`)

### 1.2. Проблемы в предыдущих расчетах (строки 198-373)

**Расчет 1 (строки 198-355):**
- ❌ **ОШИБКА**: `l_current=149.80` при `l_stable=99.90, l_unstable=0.10`
  - Правильное значение: `l_current = abs(99.90 - 0.10) * 0.5 = 49.90`
  - Это указывает на использование старой версии кода до исправления
- ❌ Бинарный поиск достиг максимального количества итераций (50)
- ❌ Результат: `distance=100.00, begin_uost=158.91, end_uost=0.23` (некорректно)

**Расчет 2 (строки 405-483):**
- ✅ **ИСПРАВЛЕНО**: `l_current=49.90` (правильно!)
- ✅ Бинарный поиск завершился за 10 итераций
- ✅ Результат: `distance=14.84, begin_uost=60.25, end_uost=63.67` (корректно)

## 2. Анализ Excel файла `Результат расчетов (2).xlsx`

### 2.1. Структура данных

**Заголовки:**
- Строка 1: Наименование режима | Схема сети | Расчетный сценарий | ЛЭП | ... | Область устойчивости, % | Остаточное напряжение в узлах ЛЭП, кВ | ... | R, Ом | ... | X, Ом | ...
- Строка 2: ... | ... | ... | Узел начала | Узел конца | Np | ... | Узел начала | Узел конца | ... | Узел начала | Узел конца | Узел начала | Узел конца

**Данные (строка 3):**
- Наименование режима: `Установленная` ✓
- Схема сети: `Нормальная схема` ✓
- Расчетный сценарий: `Кор сцен` ✓
- ЛЭП:
  - Узел начала: `40903102` ✓
  - Узел конца: `409090012` ✓
  - Np: `0` ✓
- Область устойчивости: `14.84%` ✓ (корректно, в диапазоне 0-100)
- Остаточное напряжение:
  - Узел начала: `60.25 кВ` ✓
  - Узел конца: `63.67 кВ` ✓
- R, Ом:
  - Узел начала: `2.013210 Ом` ✓
  - Узел конца: `11.556790 Ом` ✓
- X, Ом:
  - Узел начала: `7.996910 Ом` ✓
  - Узел конца: `45.906090 Ом` ✓

### 2.2. Проверка корректности данных

**Проверка 1: Сумма сопротивлений**
- `begin_r + end_r = 2.013210 + 11.556790 = 13.57 Ом` ✓
- Исходное значение: `r = 13.57 Ом` ✓
- **Результат**: ✅ **СОВПАДАЕТ**

**Проверка 2: Сумма реактивностей**
- `begin_x + end_x = 7.996910 + 45.906090 = 53.903 Ом` ✓
- Исходное значение: `x = 53.903 Ом` ✓
- **Результат**: ✅ **СОВПАДАЕТ**

**Проверка 3: Область устойчивости**
- `distance = 14.84%` ✓
- Диапазон: 0-100% ✓
- **Результат**: ✅ **КОРРЕКТНО**

**Проверка 4: Остаточные напряжения**
- `begin_uost = 60.25 кВ` ✓ (положительное значение)
- `end_uost = 63.67 кВ` ✓ (положительное значение)
- **Результат**: ✅ **КОРРЕКТНО**

## 3. Выводы

### 3.1. Положительные моменты

1. ✅ **Бинарный поиск работает корректно** после последнего исправления
   - Начальное значение `l_current` рассчитывается правильно: `abs(l_stable - l_unstable) * 0.5`
   - Бинарный поиск сходится за 10 итераций
   - Финальные значения `l_stable` и `l_unstable` обновляются корректно

2. ✅ **Параметры линии извлекаются правильно**
   - Сумма `begin_r + end_r` совпадает с исходным `r = 13.57 Ом`
   - Сумма `begin_x + end_x` совпадает с исходным `x = 53.903 Ом`

3. ✅ **Остаточные напряжения извлекаются корректно**
   - Значения находятся в разумном диапазоне (60-64 кВ)
   - Извлечение из exit файла работает правильно

4. ✅ **Excel файл заполняется корректно**
   - Все данные записываются в правильные столбцы
   - Форматирование соответствует ожидаемому

### 3.2. Обнаруженные проблемы (в старых расчетах)

1. ❌ **Старая версия кода** (расчет 1, строки 198-355):
   - Неправильное начальное значение `l_current=149.80` вместо `49.90`
   - Бинарный поиск не сходился (достигнут максимум итераций)
   - Некорректный результат `distance=100.00`

2. ⚠️ **Значения шунта КЗ**
   - `begin_shunt=0.0010, end_shunt=0.0010` - это исходные значения
   - Шунт не изменяется в процессе бинарного поиска (изменяются только параметры линии)
   - Это корректное поведение, так как шунт задается в сценарии, а не рассчитывается

### 3.3. Рекомендации

1. ✅ **Код работает корректно** после последних исправлений
2. ✅ **Результаты расчетов соответствуют ожидаемым**
3. ✅ **Логика бинарного поиска реализована правильно**
4. ✅ **Извлечение параметров линии и остаточных напряжений работает корректно**

## 4. Итоговая оценка

**Статус**: ✅ **РАСЧЕТЫ ВЫПОЛНЕНЫ КОРРЕКТНО**

Все проверки пройдены успешно:
- ✅ Бинарный поиск сходится за разумное количество итераций
- ✅ Параметры линии извлекаются и суммируются правильно
- ✅ Остаточные напряжения находятся в корректном диапазоне
- ✅ Excel файл заполняется всеми необходимыми данными
- ✅ Формулы и логика соответствуют C# реализации

**Единственное замечание**: В старых расчетах (до исправления) была ошибка с начальным значением `l_current`, но она уже исправлена в текущей версии кода.

