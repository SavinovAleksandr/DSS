# Анализ проблемы с параметрами линии в узле КЗ

## Проблема

Пользователь сообщает, что в проверочных расчетах при моделировании в узле **40903102** с параметрами:
- `r = 11.556790 Ом`
- `x = 45.906090 Ом`

**устойчивость нарушается**.

## Текущие результаты расчета

Из лога и Excel файла:
- `node_kz = 40903102` (узел, где происходит КЗ)
- `ip = 40903102` (узел начала линии)
- `iq = 409090012` (узел конца линии)
- `distance = 14.84%` (расстояние от начала линии до точки КЗ)

**Параметры линии после бинарного поиска:**
- `begin_r = 2.013210 Ом, begin_x = 7.996910 Ом` (branch1_id)
- `end_r = 11.556790 Ом, end_x = 45.906090 Ом` (branch2_id)

**Проверка суммы:**
- `begin_r + end_r = 2.013210 + 11.556790 = 13.57 Ом` ✓ (совпадает с исходным r=13.57)
- `begin_x + end_x = 7.996910 + 45.906090 = 53.903 Ом` ✓ (совпадает с исходным x=53.903)

## Структура ветвей

Из кода видно:
- `branch1_id`: `ip = 40903102, iq = new_node_counter` (от узла начала к новому узлу, где КЗ)
- `branch2_id`: `ip = new_node_counter, iq = 409090012` (от нового узла к узлу конца)

**В `set_line_for_uost_calc`:**
- `id1` (branch1_id) получает: `r_part = l * r / 100.0, x_part = l * x / 100.0`
- `id2` (branch2_id) получает: `r - r_part, x - x_part`

При `l = 14.84%`:
- `branch1_id`: `r = 14.84 * 13.57 / 100 = 2.013 Ом, x = 14.84 * 53.903 / 100 = 7.997 Ом`
- `branch2_id`: `r = 13.57 - 2.013 = 11.557 Ом, x = 53.903 - 7.997 = 45.906 Ом`

## Анализ проблемы

Пользователь говорит, что при `r=11.556790` и `x=45.906090` в узле **40903102** устойчивость нарушается.

**Но:**
- `branch1_id` идет от `ip=40903102` к новому узлу (где КЗ)
- `branch2_id` идет от нового узла к `iq=409090012`

**Параметры `r=11.556790, x=45.906090` соответствуют `branch2_id`**, который идет **от нового узла (где КЗ) к узлу конца (409090012)**, а не к узлу начала (40903102).

## Возможные причины проблемы

1. **Неправильное понимание того, какие параметры соответствуют какому узлу:**
   - `begin_r, begin_x` - это параметры ветви от `ip` к точке КЗ
   - `end_r, end_x` - это параметры ветви от точки КЗ к `iq`

2. **Если `node_kz = ip = 40903102`:**
   - КЗ происходит в узле начала линии
   - `branch1_id` (от ip к новому узлу) должна иметь очень маленькие параметры (почти 0)
   - `branch2_id` (от нового узла к iq) должна иметь почти все параметры линии

3. **Но в наших результатах:**
   - `begin_r = 2.013210` (14.84% от исходного r)
   - `end_r = 11.556790` (85.16% от исходного r)
   - Это означает, что КЗ происходит на расстоянии 14.84% от начала линии, а не в узле начала

## Выводы

1. **Если `node_kz = ip = 40903102`**, то КЗ должно происходить в узле начала линии, и параметры должны быть:
   - `begin_r ≈ 0, begin_x ≈ 0` (почти нет сопротивления до точки КЗ)
   - `end_r ≈ 13.57, end_x ≈ 53.903` (почти все сопротивление после точки КЗ)

2. **Но в наших результатах:**
   - `begin_r = 2.013210` (14.84% от исходного)
   - `end_r = 11.556790` (85.16% от исходного)
   - Это означает, что КЗ происходит на расстоянии 14.84% от начала линии, а не в узле начала

3. **Проблема может быть в том, что:**
   - При проверке пользователь использует параметры `r=11.556790, x=45.906090` для узла 40903102
   - Но эти параметры соответствуют ветви от точки КЗ к узлу конца, а не к узлу начала
   - Возможно, нужно использовать параметры `begin_r, begin_x` для узла начала, а не `end_r, end_x`

## Рекомендации

1. **Проверить логику определения параметров для узла КЗ:**
   - Если `node_kz = ip`, то параметры для узла начала должны быть почти нулевыми
   - Если `node_kz = iq`, то параметры для узла конца должны быть почти нулевыми

2. **Проверить соответствие параметров узлу КЗ:**
   - Параметры `begin_r, begin_x` должны соответствовать узлу начала (ip)
   - Параметры `end_r, end_x` должны соответствовать узлу конца (iq)
   - Но если КЗ происходит в узле начала, то `begin_r, begin_x` должны быть почти нулевыми

3. **Добавить логирование для проверки:**
   - Логировать, какой узел является узлом КЗ (node_kz)
   - Логировать, какие параметры соответствуют какому узлу
   - Логировать, где именно происходит КЗ (в узле начала, в узле конца, или на линии)

