# Объяснение параметров линии для узла КЗ

## Проблема

Пользователь сообщает, что в проверочных расчетах при моделировании в узле **40903102** с параметрами:
- `r = 11.556790 Ом`
- `x = 45.906090 Ом`

**устойчивость нарушается**.

## Структура ветвей в расчете

При расчете остаточного напряжения линия разбивается на две ветви:

1. **branch1_id**: от узла начала (`ip`) к новому узлу (где происходит КЗ)
   - Параметры: `begin_r, begin_x`
   - Эти параметры соответствуют части линии от узла начала до точки КЗ

2. **branch2_id**: от нового узла (где происходит КЗ) к узлу конца (`iq`)
   - Параметры: `end_r, end_x`
   - Эти параметры соответствуют части линии от точки КЗ до узла конца

## Распределение параметров

В функции `set_line_for_uost_calc`:
- `id1` (branch1_id) получает: `r_part = l * r / 100.0, x_part = l * x / 100.0`
- `id2` (branch2_id) получает: `r - r_part, x - x_part`

Где `l` - это расстояние от начала линии до точки КЗ в процентах (0-100).

## Пример из лога

**Исходные параметры линии:**
- `r = 13.57 Ом`
- `x = 53.903 Ом`
- `ip = 40903102` (узел начала)
- `iq = 409090012` (узел конца)
- `node_kz = 40903102` (узел, где происходит КЗ)

**Результаты бинарного поиска:**
- `distance = 14.84%` (расстояние от начала линии до точки КЗ)
- `begin_r = 2.013210 Ом` (14.84% от исходного r)
- `begin_x = 7.996910 Ом` (14.84% от исходного x)
- `end_r = 11.556790 Ом` (85.16% от исходного r)
- `end_x = 45.906090 Ом` (85.16% от исходного x)

## Важное замечание

**Если `node_kz == ip` (КЗ в узле начала):**
- КЗ происходит в узле начала линии
- `begin_r, begin_x` должны быть почти нулевыми (почти нет сопротивления до точки КЗ)
- `end_r, end_x` должны быть почти равны исходным параметрам линии (почти все сопротивление после точки КЗ)
- `distance` должна быть близка к 0%

**Если `node_kz == iq` (КЗ в узле конца):**
- КЗ происходит в узле конца линии
- `begin_r, begin_x` должны быть почти равны исходным параметрам линии (почти все сопротивление до точки КЗ)
- `end_r, end_x` должны быть почти нулевыми (почти нет сопротивления после точки КЗ)
- `distance` должна быть близка к 100%

**Если КЗ происходит на линии (не в узле):**
- `distance` находится в диапазоне 0.1-99.9%
- Параметры распределяются пропорционально `distance`

## Анализ текущей ситуации

В логе видно:
- `node_kz = 40903102`
- `ip = 40903102`
- `distance = 14.84%`

**Это означает, что:**
- КЗ происходит на расстоянии 14.84% от начала линии, а не в узле начала
- Если бы КЗ происходило в узле начала, `distance` была бы близка к 0%

**Параметры для узла 40903102 (ip):**
- `begin_r = 2.013210 Ом, begin_x = 7.996910 Ом`
- Это параметры ветви от узла начала до точки КЗ

**Параметры для узла 409090012 (iq):**
- `end_r = 11.556790 Ом, end_x = 45.906090 Ом`
- Это параметры ветви от точки КЗ до узла конца

## Проблема пользователя

Пользователь говорит, что при `r=11.556790, x=45.906090` в узле **40903102** устойчивость нарушается.

**Но:**
- `r=11.556790, x=45.906090` - это параметры `end_r, end_x`
- Эти параметры соответствуют ветви от точки КЗ к узлу конца (`iq = 409090012`)
- Они **НЕ** соответствуют узлу начала (`ip = 40903102`)

**Возможные причины:**
1. Пользователь использует неправильные параметры для проверки
2. Пользователь проверяет параметры для узла конца, а не для узла начала
3. Логика определения параметров для узла КЗ требует уточнения

## Рекомендации

1. **Для узла начала (ip = 40903102):**
   - Использовать параметры: `begin_r = 2.013210 Ом, begin_x = 7.996910 Ом`
   - Эти параметры соответствуют части линии от узла начала до точки КЗ

2. **Для узла конца (iq = 409090012):**
   - Использовать параметры: `end_r = 11.556790 Ом, end_x = 45.906090 Ом`
   - Эти параметры соответствуют части линии от точки КЗ до узла конца

3. **Для узла, где происходит КЗ (node_kz = 40903102):**
   - Если КЗ происходит в узле начала, то параметры для этого узла должны быть почти нулевыми
   - Но в текущих результатах `distance = 14.84%`, что означает, что КЗ происходит на линии, а не в узле

4. **Проверка:**
   - Если пользователь проверяет устойчивость в узле 40903102 с параметрами `r=11.556790, x=45.906090`, то это неправильно
   - Для узла 40903102 нужно использовать параметры `r=2.013210, x=7.996910`

