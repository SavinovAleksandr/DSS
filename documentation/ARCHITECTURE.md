# Архитектура приложения DynStabSpace

## Общая архитектура

### Тип приложения
- **Платформа:** .NET Framework 4.0.30319
- **UI Framework:** WPF (Windows Presentation Foundation)
- **Паттерн:** MVVM (Model-View-ViewModel)
- **Язык:** C# (предположительно)

## Структура компонентов

### 1. Главное окно (MainWindow)

```
DynStabSpace.MainWindow
├── XAML разметка (MainWindow.xaml)
├── Code-behind (MainWindow.xaml.cs)
└── ViewModel (MainWindowViewModel)
```

**Обнаруженные компоненты:**
- `System.Windows.Controls` - элементы управления WPF
- `System.Windows.Input` - обработка ввода
- `MouseButtonEventHandler` - обработка событий мыши
- `MessageBoxButton` - диалоговые окна

### 2. Модули расчетов

#### 2.1. UostCalc (Установившиеся режимы)
- Расчет установившихся режимов работы энергосистемы
- Методы: `Calc`, `get_Max`

#### 2.2. TimeKzCalc (Время короткого замыкания)
- Расчет времени короткого замыкания
- Методы: `Calc`, `get_TimeKzCalc`

#### 2.3. DynamicCalc (Динамические расчеты)
- Расчет динамических процессов
- Методы: `Calc`, `get_DynamicCalc`

#### 2.4. MdpCalc (МДП - Мгновенные динамические процессы)
- Расчет мгновенных динамических процессов
- Методы: `Calc`, `get_MdpCalc`
- Временные файлы: `mdp_calc_tmp.rst`

#### 2.5. ShuntCalc (Расчет шунтов)
- Расчет шунтирующих устройств
- Методы: `Calc`, `get_ShuntCalc`
- Вспомогательные методы: `FindShuntKZ`

### 3. Работа с данными

#### 3.1. Excel интеграция (EPPlus)
- **Библиотека:** EPPlus.dll
- **Функции:**
  - Чтение входных данных из Excel
  - Запись результатов в Excel
  - Формат: `.xlsx`
  - Имя файла результатов: "Результат расчетов.xlsx"

#### 3.2. Визуализация (OxyPlot)
- **Библиотека:** OxyPlot.dll, OxyPlot.Wpf.dll
- **Компоненты:**
  - `PlotModel` - модель графика
  - `PlotView` - представление графика
  - `Series` - серии данных
  - `LineSeries` - линейные графики
  - `MajorGridlineStyle` - стили сетки

### 4. Утилиты

#### 4.1. Работа с файлами
- `FindTemplatePathWithExtension` - поиск шаблонов
- `GetPictures` - получение изображений
- `ResultToFiles` - сохранение результатов

#### 4.2. Настройки
- `get_Settings` - получение настроек приложения

## Потоки данных

```
Входные данные (Excel)
    ↓
Парсинг данных (EPPlus)
    ↓
Модули расчетов
    ├── UostCalc
    ├── TimeKzCalc
    ├── DynamicCalc
    ├── MdpCalc
    └── ShuntCalc
    ↓
Обработка результатов
    ↓
Визуализация (OxyPlot)
    ↓
Сохранение результатов
    ├── Excel файлы
    └── Временные файлы (.rst)
```

## Структура файлов результатов

```
DynStabSpace/
└── [YYYY-MM-DD HH-MM-SS] [Тип расчета]/
    ├── Результат расчетов.xlsx
    └── [временные файлы].rst
```

**Типы расчетов:**
- "Пакетный расчет ДУ" - пакетные расчеты динамической устойчивости
- "МДП ДУ" - расчет мгновенных динамических процессов

## Зависимости

### Внешние библиотеки

1. **EPPlus** (версия из DLL)
   - Работа с Excel файлами
   - Чтение/запись данных
   - Форматирование

2. **OxyPlot** (версия из DLL)
   - Построение графиков
   - Интеграция с WPF
   - Визуализация результатов

### .NET Framework компоненты

- `System.Windows` - базовые WPF компоненты
- `System.Windows.Controls` - элементы управления
- `System.Windows.Input` - обработка ввода
- `System.Windows.Markup` - XAML разметка
- `System.Windows.Threading` - многопоточность
- `System.Resources` - ресурсы приложения

## Паттерны проектирования

### MVVM (Model-View-ViewModel)
- **Model** - модели данных в папке `Models/`
- **View** - XAML представления в папке `Views/`
- **ViewModel** - логика представлений в папке `ViewModels/`

### Command Pattern
- Обработка действий пользователя через команды

### Observer Pattern
- Привязка данных через DataBinding
- Обновление UI при изменении данных

## Рекомендации по улучшению

### Архитектурные улучшения

1. **Разделение ответственности**
   - Выделить бизнес-логику из ViewModels
   - Создать сервисный слой для расчетов

2. **Dependency Injection**
   - Использовать DI контейнер для управления зависимостями
   - Упростить тестирование

3. **Асинхронность**
   - Использовать async/await для длительных операций
   - Улучшить отзывчивость UI

4. **Обработка ошибок**
   - Централизованная обработка исключений
   - Логирование ошибок

5. **Конфигурация**
   - Вынести настройки в конфигурационные файлы
   - Поддержка различных профилей

### Производительность

1. **Кэширование**
   - Кэширование результатов расчетов
   - Оптимизация работы с Excel

2. **Параллелизм**
   - Параллельные расчеты для пакетных операций
   - Использование Task Parallel Library

3. **Оптимизация памяти**
   - Освобождение ресурсов
   - Использование using statements

## Следующие шаги анализа

1. Декомпилировать код для детального изучения
2. Проанализировать алгоритмы расчетов
3. Изучить обработку данных
4. Проанализировать производительность
5. Определить узкие места

